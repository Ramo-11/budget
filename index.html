<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Sahab Budget</title>
        <!-- Google Fonts - Inter -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
        <!-- CSS Files -->
        <link rel="stylesheet" href="css/base.css" />
        <link rel="stylesheet" href="css/features.css" />
        <link rel="stylesheet" href="css/dashboard.css" />
        <link rel="stylesheet" href="css/budget-view.css" />
        <link rel="stylesheet" href="css/modals.css" />
        <link rel="stylesheet" href="css/getting-started.css" />
        <link rel="icon" href="/images/logo.png" type="image/x-icon" />

        <!-- External Libraries -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

        <!-- Prevent tutorial flash: check localStorage before render -->
        <script>
            (function() {
                if (localStorage.getItem('sahabBudget_hideGettingStarted') === 'true' &&
                    localStorage.getItem('sahabBudget_showGettingStarted') !== 'true' &&
                    localStorage.getItem('sahabBudget_showTutorial') !== 'true') {
                    document.documentElement.classList.add('tutorial-hidden');
                }
            })();
        </script>
        <style>
            .tutorial-hidden #gettingStartedSection { display: none !important; }
        </style>
    </head>
    <body>
        <div class="container">
            <!-- Header -->
            <div class="header">
                <div class="header-inner">
                    <div class="header-brand">
                        <img
                            src="/images/logo.png"
                            alt="Sahab Solutions"
                            class="header-logo"
                        />
                        <div>
                            <h1 class="header-title">Sahab Budget</h1>
                            <p class="header-subtitle">
                                by
                                <a href="https://sahab-solutions.com" target="_blank">Sahab Solutions</a>
                            </p>
                        </div>
                    </div>

                    <button class="menu-toggle" onclick="toggleMobileMenu()">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>

                    <div class="nav-buttons" id="mobileNav">
                        <a href="index.html" class="nav-btn active">Dashboard</a>
                        <a href="analytics.html" class="nav-btn">Analytics</a>
                        <a href="settings.html" class="nav-btn">Settings</a>
                        <a href="about.html" class="nav-btn">About</a>
                        <button class="help-btn mobile-only" onclick="showHelp()" title="Help & Tutorial">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                <line x1="12" y1="17" x2="12.01" y2="17"></line>
                            </svg>
                            <span>Help</span>
                        </button>
                    </div>

                    <div class="header-actions">
                        <button class="help-btn" onclick="showHelp()" title="Help & Tutorial">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                <line x1="12" y1="17" x2="12.01" y2="17"></line>
                            </svg>
                        </button>
                    </div>

                    <div class="nav-overlay" id="navOverlay" onclick="toggleMobileMenu()"></div>
                </div>
            </div>

            <!-- Getting Started Section -->
            <div class="getting-started-section" id="gettingStartedSection">
                <div class="getting-started-content">
                    <div class="getting-started-header">
                        <h2>Welcome to Sahab Budget!</h2>
                        <p>New here? Watch our quick tutorial or try with sample data</p>
                        <button
                            class="btn btn-secondary getting-started-hide-btn"
                            onclick="toggleGettingStarted()"
                            title="Hide this section"
                        >
                            Hide
                        </button>
                    </div>

                    <div class="getting-started-grid">
                        <div class="tutorial-card">
                            <h3>Watch Tutorial</h3>
                            <p>Learn how to use Sahab Budget in just 3 minutes</p>
                            <div class="video-wrapper" id="videoWrapper">
                                <iframe
                                    src="https://embed.app.guidde.com/playbooks/gBx67acerFe4SV2D78jUn9?mode=videoOnly"
                                    frameborder="0"
                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                    allowfullscreen
                                >
                                </iframe>
                            </div>
                        </div>

                        <div class="sample-data-card">
                            <h3>Try Sample Data</h3>
                            <p>Explore all features risk-free with demo transactions</p>
                            <button class="btn btn-primary" onclick="loadSampleData()">
                                Load Sample Data
                            </button>
                            <div
                                class="sample-mode-indicator"
                                id="sampleModeIndicator"
                            >
                                <span>✨ Sample Mode Active</span>
                                <button class="btn btn-secondary btn-sm" onclick="exitSampleMode()">
                                    Exit Sample Mode
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sample Mode Banner -->
            <div class="sample-mode-banner" id="sampleModeBanner">
                <div class="banner-content">
                    <span>You're viewing sample data - feel free to explore all features!</span>
                    <button class="btn btn-secondary btn-sm" onclick="exitSampleMode()">
                        Exit Sample Mode
                    </button>
                </div>
            </div>

            <!-- Upload Section -->
            <div class="upload-section">
                <div class="upload-section-inner">
                    <div class="file-input-wrapper">
                        <svg class="upload-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="17 8 12 3 7 8"></polyline>
                            <line x1="12" y1="3" x2="12" y2="15"></line>
                        </svg>
                        <input
                            type="file"
                            id="csvFile"
                            accept=".csv"
                            multiple
                            onchange="handleFileUpload(event)"
                        />
                        <span>Upload CSV Files</span>
                    </div>

                    <div class="month-selector" id="monthSelector">
                        <label>View:</label>
                        <select id="monthDropdown" onchange="switchToMonth(this.value)"></select>
                    </div>

                    <div class="search-box-wrapper">
                        <div class="search-box-input">
                            <svg class="search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="11" cy="11" r="8"></circle>
                                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                            </svg>
                            <input
                                type="text"
                                id="dashboardSearch"
                                placeholder="Search transactions..."
                                onkeyup="handleDashboardSearch(event)"
                            />
                        </div>
                    </div>

                    <div class="action-buttons">
                        <button
                            class="btn-feature budget-goals"
                            onclick="openBudgetGoals()"
                            title="View budget goals"
                        >
                            <span class="btn-feature-icon">
                                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <circle cx="12" cy="12" r="6"></circle>
                                    <circle cx="12" cy="12" r="2"></circle>
                                </svg>
                            </span>
                            <span class="btn-feature-text">
                                <span class="btn-feature-label">Budget Goals</span>
                                <span class="btn-feature-sublabel">Track your limits</span>
                            </span>
                        </button>
                        <button
                            class="btn-feature compare-months"
                            onclick="openComparison()"
                            title="Compare two months"
                        >
                            <span class="btn-feature-icon">
                                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="18" y1="20" x2="18" y2="10"></line>
                                    <line x1="12" y1="20" x2="12" y2="4"></line>
                                    <line x1="6" y1="20" x2="6" y2="14"></line>
                                </svg>
                            </span>
                            <span class="btn-feature-text">
                                <span class="btn-feature-label">Compare Months</span>
                                <span class="btn-feature-sublabel">See trends</span>
                            </span>
                        </button>
                    </div>
                </div>

                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>Processing your data...</p>
                </div>
            </div>

            <!-- Dashboard View -->
            <div class="view active" id="dashboardView">
                <div class="summary-cards" id="summaryCards"></div>
                <div class="charts-container">
                    <div class="chart-wrapper">
                        <h3>Expense Distribution</h3>
                        <canvas id="pieChart"></canvas>
                    </div>
                    <div class="chart-wrapper">
                        <h3>Category Breakdown</h3>
                        <canvas id="barChart"></canvas>
                    </div>
                </div>
                <div class="breakdown-header">
                    <h3 class="section-header">Detailed Breakdown</h3>
                    <div id="sortControls"></div>
                </div>
                <div class="category-details" id="categoryDetails"></div>
            </div>
        </div>

        <!-- Transactions Modal -->
        <div class="modal" id="transactionsModal">
            <div class="modal-content" style="width: 800px">
                <div class="modal-header">
                    <h2 id="modalTitle">Transactions</h2>
                    <button class="close-btn" onclick="closeModal('transactionsModal')">×</button>
                </div>
                <div class="modal-body">
                    <div class="transactions-list" id="transactionsList"></div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeModal('transactionsModal')">
                        Close
                    </button>
                </div>
            </div>
        </div>

        <!-- Comparison Modal -->
        <div class="modal" id="comparisonModal"></div>

        <!-- Date Range Modal -->
        <div class="modal" id="dateRangeModal"></div>

        <!-- Column Mapping Modal -->
        <div class="modal" id="columnMappingModal">
            <div class="modal-content column-mapping-modal">
                <div class="modal-header">
                    <h2>Map CSV Columns</h2>
                    <button class="close-btn" onclick="cancelColumnMapping()">×</button>
                </div>
                <div class="modal-body">
                    <div class="mapping-notice">
                        <p>We couldn't automatically detect your bank's CSV format. Please tell us which columns contain the transaction data.</p>
                    </div>

                    <div class="csv-preview">
                        <h4>Preview of your CSV data:</h4>
                        <div class="preview-table-wrapper">
                            <table class="preview-table" id="csvPreviewTable"></table>
                        </div>
                    </div>

                    <div class="column-mapping-form">
                        <div class="mapping-field">
                            <label for="dateColumnSelect">Date Column <span class="required">*</span></label>
                            <select id="dateColumnSelect" class="mapping-select">
                                <option value="">-- Select column --</option>
                            </select>
                            <span class="field-hint">The column containing transaction dates</span>
                        </div>

                        <div class="mapping-field">
                            <label for="descriptionColumnSelect">Description Column <span class="required">*</span></label>
                            <select id="descriptionColumnSelect" class="mapping-select">
                                <option value="">-- Select column --</option>
                            </select>
                            <span class="field-hint">The column with merchant/transaction names</span>
                        </div>

                        <div class="mapping-field">
                            <label for="amountColumnSelect">Amount Column <span class="required">*</span></label>
                            <select id="amountColumnSelect" class="mapping-select">
                                <option value="">-- Select column --</option>
                            </select>
                            <span class="field-hint">The column containing transaction amounts</span>
                        </div>

                        <div class="mapping-field">
                            <label class="checkbox-label">
                                <input type="checkbox" id="amountNegativeExpense" checked>
                                <span>Negative amounts are expenses</span>
                            </label>
                            <span class="field-hint">Uncheck if your bank uses positive numbers for expenses</span>
                        </div>

                        <div class="mapping-field">
                            <label for="bankNameInput">Save as bank preset (optional)</label>
                            <input type="text" id="bankNameInput" class="mapping-input" placeholder="e.g., Bank of America">
                            <span class="field-hint">Save this mapping for future uploads from the same bank</span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="cancelColumnMapping()">Cancel</button>
                    <button class="btn btn-primary" onclick="applyColumnMapping()">Import Transactions</button>
                </div>
            </div>
        </div>

        <!-- JavaScript Files -->
        <script src="js/sync.js"></script>
        <script src="js/comparison.js"></script>
        <script src="js/daterange.js"></script>
        <script src="js/widget.js"></script>
        <script src="js/core.js"></script>
        <script src="js/rules.js"></script>
        <script src="js/utils.js"></script>
        <script src="js/columnMapping.js"></script>
        <script src="js/dashboard.js"></script>
        <script src="js/budgetView.js"></script>
        <script src="js/main.js"></script>
        <script src="js/mobile.js"></script>
        <script src="js/getting-started.js"></script>
    </body>
</html>
